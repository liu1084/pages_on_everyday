### Java架构师面试题

- kafka的工作原理

  
- kafka和rabbitMQ的区别
- 怎么处理RabbitMQ消息重复消费和消息顺序的问题
1. 消息的重复消费
   - 消息重复执行,很少会出现.一般会在如下场景下偶尔会发生: 任务超时,没有及时返回状态, 引起任务重新加入队列, 重新消费等.
   - 保证任务的幂等性,即:执行的次数跟结果无关;如果不能保证任务的幂等性,可以借助数据库临时表来记录消费的结果.
2. 消息顺序

   - 大多数场景都不需要消息的有序的，如果对于消息顺序敏感，那么我们这里给出的方法是 消息体通过hash分派到队列里，每个队列对应一个消费者，多分拆队列。

   - 同一组的任务会被分配到同一个队列里，每个队列只能有一个worker来消费，这样避免了同一个队列多个消费者消费时，就会有乱序的可能！ t1, t2 两个任务， t1 虽然被c1先pop了，但是有可能c2先把 t2 任务给完成了。

     一句话，主动去分配队列，单个消费者。

- HashMap的数据结构
- MySQL的索引
  1. InnoDB引擎采用的既不是哈希索引,也不是二叉树,而是一种加强的B树.由于B树有一部分数据存储在非叶子节点上,而B+树的数据存储在父节点和叶子节点上,所以比B树更加稳定.
  2. 叶子节点存储的数据以主键或者非主键索引为排序规则,采用双链表排序后,以数据页放在磁盘上;
  3. 在树上进行数据的插入或删除,涉及到页分裂和页合并的复杂过程;
  4. 聚集索引(主键索引)
     - 一张表只存在一个主键索引
     - 聚集索引会将整条记录的数据放在索引下;
  5. 非聚集索引(以非主键列建立的索引)
     - 非聚集索引可以有多个,并且可以用多个字段建立联合索引;
     - 非聚集索引的叶子节点并不存储整条数据,而是存储指向聚集索引的指针;
  6. 单值索引(单列)
     - 与非聚集索引类似,单值索引按照指定列建立所以排序,建立二叉树.当搜索到目标后,在通过主键索引去读取整条数据.
  7. 唯一索引
     - 唯一索引使得单列或者多列的值在记录中保证唯一性
  8. 联合索引
     - 联合索引会对相关的每一列进行排序
  9. 覆盖索引
     - 如果查找的列刚好是联合索引的值, 非聚集索引就会取联合索引下的记录,没必要再通过主键索引.
     - 为什么不用select * ,原因就在于次,不仅仅是为了减少读取更多列带来的开销,而是为了覆盖索引.
     - 使用覆盖索引,可以有效的减少磁盘IO,提高性能.
  10. 最左前缀原则
      - 联合索引已经按照所有列进行了数据排序,所有要使用联合索引,前面的列不能跳过
  11. 索引失效
      - 最左前缀
      - 使用内置函数运算的列
      - 使用!=, is null, is not null
      - 范围查询的列
      - 以通配符开头的模糊查询
  12. InnoDB使用的是行锁,如果更新时索引失效了,行锁会变成表锁,应该避免