## JAVA 调用C/C++

>   https://www3.ntu.edu.sg/home/ehchua/programming/java/javanativeinterface.html#zz-3.



-   建立native方法并在合适的地方调用此方法

```java
package jni;

public class Hello {
	static {
        //生成的.so或者.dll文件名称必须是libhello.so或者hello.dll
		System.loadLibrary("hello"); 
	}
	//调用的c程序方法
	private native void sayHello();

	public static void main(String[] args) {
        //java调用
		new Hello().sayHello();
	}
}
```

-   使用javac编译并生成header文件

```shell
/tmp/java/jni# javac -h . Hello.java
/tmp/java/jni# ls
Hello.class  Hello.java  jni_Hello.h

/tmp/java/jni# cat jni_Hello.h
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class jni_Hello */

#ifndef _Included_jni_Hello
#define _Included_jni_Hello
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     jni_Hello
 * Method:    sayHello
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_jni_Hello_sayHello
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

```

-   创建c程序, 引入jni.h和生成的header文件

```shell
/tmp/java/jni# vi HelloWorld.c
```



```c

#include <stdio.h>
#include <jni.h>
#include "jni_Hello.h"
JNIEXPORT void JNICALL Java_jni_Hello_sayHello (JNIEnv *env, jobject objThis) {
        printf("Hello World!\n");
        return;
}
```

-   编译c程序为libxxx.so或者xxx.dll

```shell
# gcc -I"$JAVA_HOME/include" -I"$JAVA_HOME/include/linux"  -shared  -o libhello.so HelloWorld.c
root@green-dev-85:/tmp/java/jni# ls
Hello.class  Hello.java  HelloWorld.c  jni_Hello.h  libhello.so
```

-   测试java程序调用是否成功

```shell
# java -cp jni:$CLASS_PATH -Djava.library.path=jni jni.Hello
Hello World!
```

