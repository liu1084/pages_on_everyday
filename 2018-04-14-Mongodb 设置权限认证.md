### Mongodb 设置权限认证
0. mongod.conf

```shell

# mongod.conf

# for documentation of all options, see:
#   http://docs.mongodb.org/manual/reference/configuration-options/

# where to write logging data.
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log

# Where and how to store data.
storage:
  dbPath: dbs
  journal:
    enabled: true
#  engine:
#  mmapv1:
#  wiredTiger:

# how the process runs
processManagement:
  fork: true  # fork and run in background
  pidFilePath: /tmp/mongod.pid  # location of pidfile
  timeZoneInfo: /usr/share/zoneinfo

# network interfaces
net:
  port: 27017
  bindIp: 127.0.0.1  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.


#security:

#operationProfiling:

#replication:

#sharding:

## Enterprise-Only Options

#auditLog:

#snmp:
```

1. 启动mongod

```shell
bin/mongod -f config/mongod.conf
```

2. 连接mongo

```shell
bin/mongo mongo -u green26 -p ***************
```

3. 切换到admin数据库，添加用户

```
## 打开admin数据库

> use admin
switched to db admin

## 新建用户 test
> db.createUser({
    user: 'test',
    pwd: 'test',
    roles: [{
    	role: 'read', db: 'admin'
    }]
});

db.createUser({
    user: 'sinoval',
    pwd: 'sinoval@2022',
    roles: [{
    	role: 'readWrite', db: 'logs'
    }]
});

> use iot;
> db.iot.insertMany([{_id: 1}]);

## 授权
> db.grantRolesToUser("test", [ { role: "readWrite", db: "iot"} ]);

##查看用户权限
> db.getUser('test');
{
        "_id" : "admin.test",
        "userId" : UUID("a96ea2e7-f2a4-415e-b0d7-c281b1b087ab"),
        "user" : "test",
        "db" : "admin",
        "roles" : [
                {
                        "role" : "read",
                        "db" : "admin"
                },
                {
                        "role" : "read",
                        "db" : "iot"
                }
        ],
        "mechanisms" : [
                "SCRAM-SHA-1",
                "SCRAM-SHA-256"
        ]
}

# 退出
> quit();

# 使用test用户登录
> show dbs;
> use iot;
> db.getUser("test");
> db.im.insertMany([ {_id: 1} ]);
> quit()；

```

4. 修改配置文件：
```shell
security:
  authorization: "enabled"
```

5. 重启mongod

6. 以admin用户登陆服务器

```shell
bin/mongo -u 'test' -p 'test' --authenticationDatabase 'admin'
```

7. 创建一个开发用户：

```shell

> use report
switched to db report
> db.createUser({
... user: 'liujun',
... pwd: '1',
... roles:[{ role: 'readWrite', db: 'report'}, { role: 'readWrite', db: 'test'}]
... });
Successfully added user: {
	"user" : "liujun",
	"roles" : [
		{
			"role" : "readWrite",
			"db" : "report"
		},
		{
			"role" : "readWrite",
			"db" : "test"
		}
	]
}


db.createUser({
... user: 'sinoval',
... pwd: 'sinoval@2022',
... roles:[{ role: 'readWrite', db: 'logs'}]
... });
```
