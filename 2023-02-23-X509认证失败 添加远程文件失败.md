## X509认证失败 添加远程文件失败



Failed to execute goal com.spotify:dockerfile-maven-plugin:1.4.13:build (default) on project crass-dybbuk: Could not build image: ADD failed: Get "https://oss.cinaval.com:8896/apm/sw/agent/skywalking-agent.jar": x509: certificate signed by unknown authority -> [Help 1]



### 解决办法：添加信任的CA根证书到服务器

-   ## **Overview**

    A trusted root certificate must be added manually if you want to send or receive messages signed by root authorities where these authorities are not installed on the server.

    ## **Step-By-Step Guide**

    ## Mac OS X

    1.  To add, use the command:
        sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/new-root-certificate.crt

        

    2.  To remove, use the command:
        sudo security delete-certificate -c "<name of existing certificate>"

    ## Windows

    1.  To add, use the command: 
        certutil -addstore -f "ROOT" new-root-certificate.crt

        

    2.  To remove, use the command:
        certutil -delstore "ROOT" serial-number-hex

    ## Linux (Ubuntu, Debian)

    1.  To add: 
        1.  Copy your CA to `dir /usr/local/share/ca-certificates/`
        2.  Use command: `sudo cp foo.crt /usr/local/share/ca-certificates/foo.crt`
        3.  Update the CA store: `sudo update-ca-certificates`
    2.  To remove:
        1.  Remove your CA.
        2.  Update the CA store: `sudo update-ca-certificates --fresh`

-   在docker的认证目录添加远程服务器的证书

```shell
# mkdir -p /etc/docker/certs.d/foo.com:8896
# ls -lh
total 32K
-rw-r--r-- 1 root root 1.8K Jan 14 13:59 ca.crt
-rw-r--r-- 1 root root 2.1K Jan 14 13:59 oss.cinaval.com.crt
-rw-r--r-- 1 root root 1.7K Jan 14 13:59 oss.cinaval.com.key
```



-   重启docker

```shell
systemctl restart docker.service
```

